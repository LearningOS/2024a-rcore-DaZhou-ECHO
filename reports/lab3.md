# 总结：
在给出的ch3的基础代码上进行一些完善，实现了一个支持多个任务分时轮流进行的系统，使用TASK_MANAGER懒定义全局变量来记录整个任务的进行。其中Task_Info来记录进程运行状态，和各个系统调用的调用次数，和第一次调用系统调用和当前时间。成功通过测例最终实现三个任务交替执行输出ABC。
## 系统支持功能：
1.一次性加载所有应用程序，减少任务切换开销
2.支持任务切换机制，保存切换前后程序上下文
3.支持程序主动放弃处理器，实现yield系统调用
4.以时间片轮转算法调度用户程序，实现资源的时分复用


# 问答题：
## 1.正确进入 U 态后，程序的特征还应有：使用 S 态特权指令，访问 S 态寄存器后会报错。 请同学们可以自行测试这些内容（运行 三个 bad 测例 (ch2b_bad_*.rs) ）， 描述程序出错行为，同时注意注明你使用的 sbi 及其版本。
[kernel] PageFault in application, bad addr = 0x0, bad instruction = 0x804003a4, kernel killed it.
[kernel] IllegalInstruction in application, kernel killed it.
[kernel] IllegalInstruction in application, kernel killed it.

## 2.深入理解 trap.S 中两个函数 __alltraps 和 __restore 的作用，并回答如下问题:
### 1.L40：刚进入 __restore 时，a0 代表了什么值。请指出 __restore 的两种使用情景。
a0 的值是指向一个包含当前任务状态信息的 TrapContext 结构体的指针。
两种情景：系统调用返回和异常处理后恢复。
### 2.L43-L48：这几行汇编代码特殊处理了哪些寄存器？这些寄存器的的值对于进入用户态有何意义？请分别解释。
sstatus：保存特权级状态
sepc：存储下一条执行指令的地址
sscratch：保存上下文
### 3.L50-L56：为何跳过了 x2 和 x4？
x2栈指针，x4线程指针。
为了避免不必要的保存和恢复操作，减少上下文切换的开销。
### 4.L60：该指令之后，sp 和 sscratch 中的值分别有什么意义？
交换sscratch和sp，原来：sp指向用户栈，sscratch指向内核栈。现在：sp指向内核栈，sscratch指向用户栈。
### 5.__restore：中发生状态切换在哪一条指令？为何该指令执行之后会进入用户态？
sret进行状态转换：内核返回用户模式。RISC-V处理器将控制权转移到sepc寄存器存储的地址，同时状态寄存器模式切换到用户模式。
### 6.L13：该指令之后，sp 和 sscratch 中的值分别有什么意义？
sp指向用户栈，sscratch指向内核栈
### 7.从 U 态进入 S 态是哪一条指令发生的？
sret



# 荣誉准则：
在完成本次实验的过程（含此前学习的过程）中，我曾分别与 以下各位 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

无

此外，我也参考了 以下资料 ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：
只参考了《rCore-Camp-Guide-2024A 文档》实验指导书的内容。


3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。


# 感想：	
	由于种种原因，对于这次的第一个实验总是没有信心，心里认为它是一座高山，但是做完回头看，只觉得平常。
	从开始的不知所措四处碰壁，到慢慢的可以调试代码，一步步实现功能真的觉得不可思议，在所有测例全部通过的时候心情却是十分平淡，只是觉得实现了该实现的功能，完成了lab3分时多任务的要求。
	这次的实验除了让我认识到了分时多任务的实现，更重要的是让我知道了应该去怎么学习，心里没有高山，只觉得事在人为。
	回顾实现的过程，确实会有侥幸的心理，想着“借鉴”，实则为抄袭，在知道荣誉准则的存在后，从前的心中的骄傲似乎被唤醒了，只觉得可耻，幸好自己最终坚持下来了。
	虽然只是完成了实验一，但是十分有成就感，只觉得未来可期，前途一片光明，哈哈哈哈哈哈哈哈哈哈哈

